trigger:
- master
- releases/*

jobs:

# Test production bundle on Linux using Node 4
- job: Prod_Linux
  displayName: Test production bundle on Linux
  pool:
    vmImage: 'Ubuntu 16.04'
  strategy:
    matrix:
      Node4:
        node_version: '4.x'
      Node9:
        node_version: '9.x'
  steps:
  - template: azure-pipelines/production-bundle.yml

# Build and test on Linux
- job: Tests
  displayName: Run tests
  strategy:
    matrix:
      Linux_Node_8:
        node_version: '8.x'
        image: 'Ubuntu 16.04'
      Linux_Node_11:
        node_version: '11.x'
        image: 'Ubuntu 16.04'
      MacOS_Node_8:
        node_version: '8.x'
        image: 'macos-10.13'
      Windows_Node_8:
        node_version: '8.x'
        image: 'vs2017-win2016'
  pool:
    vmImage: '$(image)'
  variables:
    report_summaries: true
  steps:
  - template: azure-pipelines/run-tests.yml

# Lint checks on Linux
- job: Lint_linux
  displayName: Lint (Linux)
  pool:
    vmImage: 'Ubuntu 16.04'
  steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '8.x'
    displayName: 'Install Node.js'

  - script: yarn install
    displayName: 'yarn install'

  - script: yarn lint
    displayName: 'Lint code'

  - script: yarn lint-docs
    displayName: 'Lint docs'